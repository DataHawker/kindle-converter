version: '3.8'

services:
  api:
    build: ./api
    container_name: kindle-api
    restart: unless-stopped
    ports:
      - "5678:5678"
    environment:
      - NODE_ENV=production
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_PORT=${SMTP_PORT}
      - SMTP_USER=${SMTP_USER}
      - SMTP_PASS=${SMTP_PASS}
      - SMTP_SENDER=${SMTP_SENDER}
    volumes:
      - /mnt/nas/media/Books:/mnt/nas/media/Books:rw
      - ./.env:/app/.env:ro
    networks:
      - kindle-net

  web-interface:
    image: nginx:alpine
    container_name: kindle-web
    restart: unless-stopped
    ports:
      - "3000:80"
    volumes:
      - ./web:/usr/share/nginx/html:ro
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - kindle-net

networks:
  kindle-net:
    driver: bridge